function draw_graphic(){if(Modernizr.svg){$graphic.empty();var t=$graphic.width();render(t),window.onresize=draw_graphic}}function render(t){function a(t){mobileThreshold>t?(console.log("mobileThreshold reached"),e.fontSize="8px",margin.left=135,e.gap=.5,l=1.5*l):(e.fontSize=null,margin.left=175,e.gap=.25)}function n(t){return{complaints:+t.complaints,awards:+t.awards,company:t.company}}function r(t,a){t.each(function(){for(var t=d3.select(this),n=t.text().split(/\s+/).reverse(),r,e=[],l=0,o=1.3,i=t.attr("y"),c=parseFloat(t.attr("dy")),s=t.text(null).append("tspan").attr("x",0).attr("y",i).attr("dy",c+"em");r=n.pop();)e.push(r),s.text(e.join(" ")),s.node().getComputedTextLength()>a&&(e.pop(),s.text(e.join(" ")),e=[r],s=t.append("tspan").attr("x",0).attr("y",i).attr("dy",++l*o+c+"em").text(r))})}var e={};a(t);var l=Math.ceil(t*aspect_height/aspect_width)-margin.top-margin.bottom;console.log("height = "+l),250>l?l=250:null;var o=d3.scale.linear().range([0,t-margin.left-margin.right]),i=d3.scale.ordinal().rangeRoundBands([0,l],e.gap),c=d3.format("0.2f"),s=d3.svg.axis().scale(o).tickFormat("").orient("top"),d=d3.svg.axis().scale(i).orient("left"),u=d3.select("#graphic").append("svg").attr("width",t).attr("height",l+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),p=d3.select("#graphic").append("div").attr("class","tooltip").style("opacity",0);d3.csv("complaints.csv",n,function(t,a){o.domain([0,d3.max(a,function(t){return t.complaints})]),i.domain(a.sort(function(t,a){return a.complaints-t.complaints}).map(function(t){return t.company})),u.selectAll(".bar").data(a).enter().append("rect").attr("class","bar").attr("x",0).attr("width",function(t){return o(t.complaints)}).attr("y",function(t){return i(t.company)}).attr("height",i.rangeBand()),u.selectAll(".label").data(a).enter().append("text").attr("class","label").text(function(t){return t.complaints}).attr("y",function(t){return i(t.company)+i.rangeBand()/2}).attr("x",function(t){return o(t.complaints)+3}).attr("dy",3),u.append("g").attr("transform","translate(-10,0)").attr("class","y axis").call(d).attr("text-anchor","end").selectAll(".tick text").call(r,margin.left),u.selectAll(".tick").style("font-size",e.fontSize)}),d3.select("#award").on("click",function(){function t(t){return t.awards=+t.awards,t}d3.csv("awards.csv",t,function(t,a){function n(){s.selectAll(".bar").transition(400).attr("width",0).each("end",e)}function e(){s.selectAll(".bar").data(a).transition().style("fill","darkred").attr("class","bar awards").attr("x",0).attr("width",function(t){return o(t.awards)}).attr("y",function(t){return i(t.company)}).attr("height",i.rangeBand()),s.selectAll(".label").data(a).transition().attr("class","label").text(function(t){return t.awards}).attr("y",function(t){return i(t.company)+i.rangeBand()/2}).attr("x",function(t){return o(t.awards)+3}).attr("dy",3),s.select(".y.axis").call(d).transition().attr("text-anchor","end").selectAll(".tick text").call(r,margin.left)}console.log(a[4]);var l=function(t,a){return 100*a};o.domain([0,d3.max(a,function(t){return t.awards})]),i.domain(a.sort(function(t,a){return a.awards-t.awards}).map(function(t){return t.company}));var c=i.domain(a.sort(function(t,a){return a.awards-t.awards}).map(function(t){return t.company}));console.log(a[4]);var s=d3.select("#graphic");s.selectAll(".tick").transition().style("opacity",0).each("end",n)})}),d3.select("#complaints").on("click",function(){function t(t){return t.complaints=+t.complaints,t}d3.csv("complaints.csv",t,function(t,a){function n(){s.selectAll(".bar").transition(400).attr("width",0).each("end",e)}function e(){s.selectAll(".bar").data(a).transition().style("fill","steelblue").attr("class","bar awards").attr("x",0).attr("width",function(t){return o(t.complaints)}).attr("y",function(t){return i(t.company)}).attr("height",i.rangeBand()),s.selectAll(".label").data(a).transition().attr("class","label").text(function(t){return t.complaints}).attr("y",function(t){return i(t.company)+i.rangeBand()/2}).attr("x",function(t){return o(t.complaints)+3}).attr("dy",3),s.select(".y.axis").call(d).transition().attr("text-anchor","end").selectAll(".tick text").call(r,margin.left)}console.log(a[4]);var l=function(t,a){return 100*a};o.domain([0,d3.max(a,function(t){return t.complaints})]),i.domain(a.sort(function(t,a){return a.complaints-t.complaints}).map(function(t){return t.company}));var c=i.domain(a.sort(function(t,a){return a.complaints-t.complaints}).map(function(t){return t.company}));console.log(a[4]);var s=d3.select("#graphic");s.selectAll(".tick").transition().style("opacity",0).each("end",n)})})}var mobileThreshold=500,aspect_width=16,aspect_height=10,tickNumber=10,margin={top:30,right:30,bottom:20,left:175},$graphic=$("#graphic"),colors={red1:"#6C2315",red2:"#A23520",red3:"#D8472B",red4:"#E27560",red5:"#ECA395",red6:"#F5D1CA",orange1:"#714616",orange2:"#AA6A21",orange3:"#E38D2C",orange4:"#EAAA61",orange5:"#F1C696",orange6:"#F8E2CA",yellow1:"#77631B",yellow2:"#B39429",yellow3:"#EFC637",yellow4:"#F3D469",yellow5:"#F7E39B",yellow6:"#FBF1CD",teal1:"#0B403F",teal2:"#11605E",teal3:"#17807E",teal4:"#51A09E",teal5:"#8BC0BF",teal6:"#C5DFDF",blue1:"#28556F",blue2:"#3D7FA6",blue3:"#51AADE",blue4:"#7DBFE6",blue5:"#A8D5EF",blue6:"#D3EAF7"};$(window).load(function(){draw_graphic()});