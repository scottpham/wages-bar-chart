function draw_graphic(){if(Modernizr.svg){$graphic.empty();var t=$graphic.width();render(t),window.onresize=draw_graphic}}function render(t){function a(t){475>t&&$("#btn-group").attr("class","btn-group-vertical")}function n(t){mobileThreshold>t?(console.log("mobileThreshold reached"),margin.left=145,i.gap=.5,o=1.5*o):(margin.left=175,i.gap=.25)}function r(t){return{complaints:+t.complaints,awards:+t.awards,company:t.company}}function e(t,a){t.each(function(){for(var t=d3.select(this),n=t.text().split(/\s+/).reverse(),r,e=[],i=0,o=1.3,l=t.attr("y"),c=parseFloat(t.attr("dy")),s=t.text(null).append("tspan").attr("x",0).attr("y",l).attr("dy",c+"em");r=n.pop();)e.push(r),s.text(e.join(" ")),s.node().getComputedTextLength()>a&&(e.pop(),s.text(e.join(" ")),e=[r],s=t.append("tspan").attr("x",0).attr("y",l).attr("dy",++i*o+c+"em").text(r))})}a(t);var i={};n(t);var o=Math.ceil(t*aspect_height/aspect_width)-margin.top-margin.bottom;console.log("height = "+o),250>o?o=250:null;var l=d3.scale.linear().range([0,t-margin.left-margin.right]),c=d3.scale.ordinal().rangeRoundBands([0,o],i.gap),s=d3.format("0.2f"),d=d3.svg.axis().scale(l).tickFormat("").orient("top"),u=d3.svg.axis().scale(c).orient("left"),p=d3.select("#graphic").append("svg").attr("width",t).attr("height",o+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),m=d3.select("#graphic").append("div").attr("class","tooltip").style("opacity",0),f=d3.format("$,.0f");d3.csv("awards.csv",r,function(t,a){l.domain([0,d3.max(a,function(t){return t.awards})]),c.domain(a.sort(function(t,a){return a.awards-t.awards}).map(function(t){return t.company})),p.selectAll(".bar").data(a).enter().append("rect").attr("class","bar bar-awards").attr("x",0).attr("width",function(t){return l(t.awards)}).attr("y",function(t){return c(t.company)}).attr("height",c.rangeBand()),p.selectAll(".label").data(a).enter().append("text").attr("class","label label-awards").text(function(t){return f(t.awards)}).attr("y",function(t){return c(t.company)+c.rangeBand()/2}).attr("x",function(t){return l(t.awards)+3}).attr("dy",3),p.append("g").attr("transform","translate(-10,0)").attr("class","y axis").call(u).attr("text-anchor","end").selectAll(".tick text").call(e,margin.left)}),d3.select("#award").on("click",function(){function t(t){return t.awards=+t.awards,t}d3.csv("awards.csv",t,function(t,a){function n(){s.selectAll(".bar").transition(400).attr("width",0).each("end",r)}function r(){s.selectAll(".bar").data(a).transition().attr("class","bar bar-awards").attr("x",0).attr("width",function(t){return l(t.awards)}).attr("y",function(t){return c(t.company)}).attr("height",c.rangeBand()),s.selectAll(".label").data(a).transition().attr("class","label label-awards").text(function(t){return f(t.awards)}).attr("y",function(t){return c(t.company)+c.rangeBand()/2}).attr("x",function(t){return l(t.awards)+3}).attr("dy",3),s.select(".y.axis").call(u).transition().attr("text-anchor","end").selectAll(".tick text").call(e,margin.left)}var i=function(t,a){return 100*a};l.domain([0,d3.max(a,function(t){return t.awards})]),c.domain(a.sort(function(t,a){return a.awards-t.awards}).map(function(t){return t.company}));var o=c.domain(a.sort(function(t,a){return a.awards-t.awards}).map(function(t){return t.company})),s=d3.select("#graphic");s.selectAll(".tick").transition().style("opacity",0).each("end",n)})}),d3.select("#complaints").on("click",function(){function t(t){return t.complaints=+t.complaints,t}d3.csv("complaints.csv",t,function(t,a){function n(){s.selectAll(".bar").transition(400).attr("width",0).each("end",r)}function r(){s.selectAll(".bar").data(a).transition().attr("class","bar bar-complaints").attr("x",0).attr("width",function(t){return l(t.complaints)}).attr("y",function(t){return c(t.company)}).attr("height",c.rangeBand()),s.selectAll(".label").data(a).transition().attr("class","label label-complaints").text(function(t){return t.complaints}).attr("y",function(t){return c(t.company)+c.rangeBand()/2}).attr("x",function(t){return l(t.complaints)+3}).attr("dy",3),s.select(".y.axis").call(u).transition().attr("text-anchor","end").selectAll(".tick text").call(e,margin.left)}var i=function(t,a){return 100*a};l.domain([0,d3.max(a,function(t){return t.complaints})]),c.domain(a.sort(function(t,a){return a.complaints-t.complaints}).map(function(t){return t.company}));var o=c.domain(a.sort(function(t,a){return a.complaints-t.complaints}).map(function(t){return t.company})),s=d3.select("#graphic");s.selectAll(".tick").transition().style("opacity",0).each("end",n)})})}var mobileThreshold=500,aspect_width=16,aspect_height=11,tickNumber=10,margin={top:30,right:70,bottom:20,left:185},$graphic=$("#graphic"),colors={red1:"#6C2315",red2:"#A23520",red3:"#D8472B",red4:"#E27560",red5:"#ECA395",red6:"#F5D1CA",orange1:"#714616",orange2:"#AA6A21",orange3:"#E38D2C",orange4:"#EAAA61",orange5:"#F1C696",orange6:"#F8E2CA",yellow1:"#77631B",yellow2:"#B39429",yellow3:"#EFC637",yellow4:"#F3D469",yellow5:"#F7E39B",yellow6:"#FBF1CD",teal1:"#0B403F",teal2:"#11605E",teal3:"#17807E",teal4:"#51A09E",teal5:"#8BC0BF",teal6:"#C5DFDF",blue1:"#28556F",blue2:"#3D7FA6",blue3:"#51AADE",blue4:"#7DBFE6",blue5:"#A8D5EF",blue6:"#D3EAF7"};$(window).load(function(){draw_graphic()});